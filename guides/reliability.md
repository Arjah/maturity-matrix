# Надёжность - гайдлайн

## Прежде чем начать

- [Ссылка на документы по надёжности](../concepts/pod-disruption-budget.md)
- [И ещё одна ссылка](https://kubernetes.io/docs/tasks/run-application/configure-pdb/)

## Мониторинг функциональности продуктов команды определён и настроен.	

Это не так сложно - ведь каждый уровень подразумевает получение нового опыта.

#### :star: Уровень 1 

  Мониторинг функциональности есть только для ключевых продуктов команды.
  То есть:
   - Метрики размечены `product_id` лейблами.
   - Собираются метрики по CPU, Memory, Input/Output network traffic
  
  ##### Как достичь

  Настроить дашборд по мониторингу ключевых продуктов команды

#### :star2: Уровень 2

  100% P1-P2 проблем видим на мониторинге.
  То есть:
   - Собираются метрики компонентов продукта как для синхронных, так и для ассинхронных интеграций. Например, метрики Http endpoint.
   - На базе собираемых метрик компонентов продукта создаются правила алертов P1-P5. 
  
  В компоненте продукта используется трейсинг запросов.
  
   ##### Как достичь

  Установить ритуалы для пересмотра/обновления метрик при развёртывании новых компонентов продуктов или процессов в существующих.
  Настроен Sentry или экпортер ptometheus метрик.
  Настроен один из инструментов трейсинга запросов: zipkin, Jaeger, OpenTelemetry, OpenTracing, Sentry.

#### :boom: Уровень 3
  
  В продуктах команды внедрён сквозной трейсинг.
  Настроен единый дашборд для мониторинга всех ключевых продуктов команды для понимания общей ситуации в системе по принципу светофора.

  ##### Как достичь
  
  Интегрироваться с подсистемой скозного трейсинга от команды observability.
  Настроить дашборды продуктов на основе рекомендаций от SRE сообщества.

  Настроить процесс - для помощи в обосновании пользы от такого подхода можно обратиться к **Дмитрию Шувару** - ответственному лидеру SRE.


### Соблюдается целевой уровень качества продуктов (SLO)

#### :star: Уровень 1 
  
  Команда умеет определять SLO своих продуктов. У команды есть согласованный уровень SLO по критичным продуктам.

  ##### Как достичь

  Узнать про принятые практики и процесс работы с SLO в компании, определить текущие значения SLO для ключевых бизнес процессов команды, согласовать с руководителем команды и SDM продукта устраивающий уровень SLO по ключевым бизнес процессам.

#### :star2: Уровень 2
  
  Настроен единый дашборд для мониторинга SLO по всем ключевым бизнес процессам команды. У ключевых сервисов команды показатели Availability and Latency не менее 99.5%.
  На уровне API-Gateway установлены SLO для Http API продуктов.
  Для асинхронных интеграций установлен SLO на обработку сообщений.
  На уровне API-Gateway выставлены квоты для методов продукта.


  ##### Как достичь

  Установить ритуалы для пересмотра/обновления метрик при развёртывании новых комопнентов продуктов или процессов в существующих.

 #### :boon: Уровень 3
  
  Все смежные продукты, влияющие на SLO команды известны и команда может отслеживать SLO смежных продуктов.
  SLO для смежных продуктов согласован с вледльцами продуктов.
  

  ##### Как достичь

  Описать c4 нотацию для продуктов своей команды, определить смежников и потребителей.
  Закрепить соглашенияими SLO как для смежных продуктов, так и для потребителей продукта.

### Настроен алертинг на случай возникновения сбоев в работе продуктов команды


#### :star: Уровень 1
  
  Настроено уведомление о сбоях в ключевом для продуктов команды слое (backend, middleware, frontend). Уведомления о сбоях отправляются в неструктурированые каналы коммуникации.



#### :star2: Уровень 2

  Уведомления о сбоях ведутся через корпоративные системы управления инцидентами (IRM) и алертами/коммуникациями (Grafana OnCall).


#### :boom: Уровень 3
  
  Поддержка приложений осуществляется непрерывно на основе матрицы эскалации и расписании дежурств.
  100% технических сбоев команда узнаёт от системы алёртинга (не от пользователей).


  ##### Как достичь

  Создать ритуалы для оптимизации процесса алертинга, чтобы избежать усталости от дежурств.
  Команда выбрала для себя оптимальный график дежурстава: 8 на 5, 12 на 5, 22 на 5, 8 на 7, 12 на 7, 22 на 7

### Нагрузочное тестирование сервисов

#### :star: Уровень 1

  Команда понимает риски и принимает осознанное решение не использовать нагрузочное тестирование или нагрузочное тестирование проводится по необходимости для самого важного сервиса команды. Самый важный — это высоконагруженный и/или участвующий в важных для бизнеса сценариях.


#### :star2: Уровень 2
  
  Составлен профиль нагрузки максимально приближенный к реальной, проводится нагрузочное тестирование всех важных компонентов продукта команды.
  Проводится сравнительный анализ результатов нагрузочного тестирования.

  ##### Как достичь

  Для проведения нагрузочного тестирования используется методология нагрузочного тестирования, разработанная в компании.

#### :boom: Уровень 3
  
  Профиль нагрузочного тестирования покрывает функционал всех компонентов продукта.
  Профиль нагрузочного тестирования обновляется вместе с появлением нового функционала.
  Нагрузочное тестирование проводится при появлении нового функционала и изменении существующего.
  

  Для frontend и middleware без СУБД проводится стресс тест.
  
  ##### Как достичь

  Проведена оценка профилей и процесса нагрузочного тестирования центром компетенций QA.


### Логирование

#### :star: Уровень 1
  
  У приложения есть логи и они попадают в OpenSearch кластер домена/коммунальный.

#### :star2: Уровень 2
  
  Логи структурированы и могут корректно обрабатыватся экпортерами логов, что обеспечивает поиск по определенным полям в OpenSearch.
  
  ##### Как достичь

  В логах есть:
  - временная метка в фиксированном формате
  - уровень логирования
  - идентификатор обрабатываемого запроса/вызова/сообщения
  - осознанное сообщение

  Для production окружения не допустим вывод логов уровня DEBUG.
  

#### :boom: Уровень 3
  
  В логах отсутствуют персональные или конфиденциальные данные.

  ##### Как достичь

  Для идентификации сущностей используются только их публичные идентификаторы, остальные значения обфусцированы или не используются.

  
### что то еще

#### :star: Уровень 1
#### :star2: Уровень 2
#### :boom: Уровень 3

